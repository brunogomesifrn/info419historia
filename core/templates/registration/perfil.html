{% extends "base.html" %}
{% load core_extras %}

{% block conteudo %}
  <div class="col-lg-12 pt-5">
    <div class= "listagem mb-4 p-4">
      {% with professor=user.is_professor %}
        <div>
          <h2 class="d-inline">Turmas</h2>
          {% if professor %}
            <a href="{% url 'turma_cadastro' %}" class="btn btn-primary mb-4 float-right" target="_blank">Cadastrar nova Turma</a>
          {% endif %}
        </div>
        <div class="row text-center mx-0 mt-4">
          {% for turma in turmas %}
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 px-2">
              <div class="card mt-4">
                <div class="card-body">
                  <h5 class="card-title">{{turma}}</h5>
                  {% if professor %}
                    <a href="{% url 'turma' turma.id %}" class="btn btn-primary m-1"><i class="fas fa-search"></i></a>
                    <a href="{% url 'turma_edicao' turma.id %}" class="btn btn-success m-1"><i class="fas fa-edit"></i></a>
                    <button data-toggle="modal" data-target="#confirmacao" data-nome="{{turma.nome}}" data-url="{% url 'turma_remocao' turma.id %}" class="btn btn-danger m-1"><i class="fas fa-trash"></i></button>
                  {% else %}
                    <a href="{% url 'turma' turma.id %}" class="btn btn-info">Acessar</a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
              {% if professor %}
                <h5>Nenhuma turma cadastrada</h5>
              {% else %}
                <h5>Você não está em nenhuma turma</h5>
              {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class= "listagem mb-4 p-4">
        <div>
          <h2 class="d-inline">Atividades</h2>
          {% if professor %}
            <a href="{% url 'atividade_cadastro' %}" class="btn btn-primary mb-4 float-right">Cadastrar nova Atividade</a>
          {% endif %}
        </div>
        <div class="row text-center mx-0 mt-4">
          {% for atividade in atividades %}
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 px-2">
              <div class="card mt-4">
                <div class="card-body">
                  <h5 class="card-title">{{atividade}}</h5>
                  {% with request.user|grupo:atividade as grupo %}
                    {% if professor %}
                        <a href="{% url 'atividade' atividade.id %}" class="btn btn-primary m-1"><i class="fas fa-search"></i></a>
                        <a href="{% url 'atividade_edicao' atividade.id %}" class="btn btn-success m-1"><i class="fas fa-edit"></i></a>
                        <button data-toggle="modal" data-target="#confirmacao" data-nome="{{atividade.assunto}}" data-url="{% url 'atividade_remocao' atividade.id %}" class="btn btn-danger m-1"><i class="fas fa-trash"></i></button>
                    {% elif atividade.fim < agora %}
                      {% firstof grupo.nota "Aguarde a liberação das notas" %}
                    {% elif atividade.fim >= agora %}
                      {% if grupo %}
                        <a href="{% url 'atividade' atividade.id %}" class="btn btn-info">Resolver</a>
                      {% else %}
                        <a href="{% url 'grupo_cadastro' atividade.id %}" class="btn btn-success my-1">Criar grupo</a>
                        <a href="" class="btn btn-info my-1">Entrar em grupo</a>
                      {% endif %}
                    {% endif %}
                  {% endwith %}
                </div>
              </div>
            </div>
            {% empty %}
              {% if professor %}
                <h5>Nenhuma atividade cadastrada</h5>
              {% else %}
                <h5>Nenhuma atividade para agora</h5>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endwith %}
    </div>
    <div class="modal fade" id="confirmacao" tabindex="-1" role="dialog" aria-labelledby="title" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
        </div>
        <div class="modal-footer">

        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{super}}
  <script type="text/javascript">
    $(() => {
        header = '<h5 class="modal-title" id="title">Apagar <span data="nome"></span>?</h5>' +
                 '<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">' +
                    '<span aria-hidden="true">&times;</span>' +
                 '</button>'
        footer = '<button type="button" class="btn btn-success" data-dismiss="modal">Cancelar</button>'+
                  '<a href="#"><button type="button" class="btn btn-danger">Apagar</button></a>'
        open_modal(header, '', footer)..on('show.bs.modal', (event) => {
          var $button = $(event.relatedTarget)
          var nome = $button.data('nome')
          var url = $button.data('url')
          var $modal = $(this)
          $modal.find('span[data=nome]').text(nome)
          $modal.find('.modal-footer a').attr('href', url)
        })
    });
  </script>
{% endblock %}