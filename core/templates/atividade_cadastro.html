{% extends 'base.html' %}
{% load widget_tweaks %}
{% load core_extras %}

{% block conteudo %}
  <div class="col-lg-12 text-center pt-5">
  	<h1>{{titulo}}</h1>
    <form method="post" class="w-75 mx-auto">
      {% csrf_token %}
      {% include 'form.html' with form=atividade_form only %}
      {% for questao_form in questoes_forms %}
        <hr />
        {% with n=forloop.counter %}
          <h3 class="mt-5">Questão {{n}}</h3>
          {% include 'form.html' with form=questao_form only %}
          {% with alternativas_forms=alternativas_forms_questao|index:forloop.counter0 %}
            {% for alternativa_form in alternativas_forms %}
              <h4>Alternativa {{forloop.counter}}</h6>
              {% include 'form.html' with form=alternativa_form only %}
            {% endfor %}
            <input type="hidden" name="quant_alternativas-q{{n}}" class="form-control" value="{{alternativas_forms|length}}" required />
            <button type="submit" class="btn btn-outline-success btn-sm my-2" name="acao" value="nova_alternativa-q{{n}}">Adicionar alternativa</button>
            <button type="submit" class="btn btn-outline-danger btn-sm my-2" name="acao" value="remover_alternativa-q{{n}}">Remover alternativa</button><br/>
          {% endwith %}
        {% endwith %}
      {% endfor %}
      <input type="hidden" name="quant_questoes" class="form-control" value="{{questoes_forms|length}}" required />
      <button type="submit" class="btn btn-success my-2" name="acao" value="nova_questao">Adicionar questão</button>
      <button type="submit" class="btn btn-danger my-2" name="acao" value="remover_questao">Remover questão</button><br/>
      <button type="submit" class="btn btn-primary btn-lg my-2" name="acao" value="salvar">Salvar</button>
  	</form>
  </div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script type="text/javascript">
    $(function(e) {
      {# A função "able_disable" testa se todos os inputs, textareas e selects possuem algum valor. Se não, o botão "salvar" será desativado #}
      var $salvar_btn = $('button[value="salvar"]');
      able_disable = function(){
        state = false
        $('input[type!=hidden], textarea, select').each(function(){
          state = state || $(this).val() == '';
        });
        $salvar_btn.prop('disabled', state);
      }
      {# Sempre que for mudado o valor ou precissionada uma tecla dentro de um input, textarea ou select, a função "able_disable" será chamada, para ativivar ou desativar o botão "salvar" quando necessário #}
      $('input, textarea, select')
        .change(function(){able_disable();})
        .keyup(function(){able_disable();});
      able_disable()

      {# Se houver 1 questão ou menos, o botão "remover questão" será desativado #}
      if ($('input[name=quant_questoes]').val() <= 1)
        $('button[value=remover_questao]').prop('disabled', true);

      {# Se houver 2 alternativas ou menos, o botão "remover alternativa" correspondente será desativado #}
      {% for n in questoes_forms|length|trange %}
        if ($('input[name=quant_alternativas-q{{n}}]').val() <= 2)
          $('button[value=remover_alternativa-q{{n}}]').prop('disabled', true);
      {% endfor %}
    });
  </script>
{% endblock %}